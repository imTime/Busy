#[Solo]imTime跨平台项目经验分享—前言

2012年11月21日，当我得知自己的病情发生极大的变化的时候，我回来立即将[imTime](http://new.imtime.com)发布，我想自己未来万一出事了，怎么也没能把东西烂在电脑里。经过两天的紧张工作，一个Alpha版本最终被发布，它还不能称之为产品，因为Bug还有一大堆，微博上一些热心网友的测试也是各种问题。

我自己也知道问题很多，但我没有办法，我也希望老天能给我多一些时间来做这个项目。如果我侥幸没事，将来我一定会把这个产品做好，它承载我对产品的梦想，没有广告，多平台接入，多语种，简单，纯粹的产品。

我原来是计划我以后上班了，利用周末或者晚上的时间完善它，每年花费反正也不高，一台VPS和种平台的认证费用，总费用不会超过1万元/年。因为产品在设计上是尽量让用户使用客户端软件，所以服务器的压力会很少，以Node.JS+Linux的VPS，服务10万的用户是绝对不会有问题的。所以就算用户的增加，我想付费用户怎么样也会足够买服务器的钱了。

整个产品全部由我一个人完成，还是挺有成就感的，特别是设计和产品上我很满意。设计上这种简约的风格我很喜欢，对于设计，我完全是很业余的，但这次我挺满意的。还有Logo的设计我也觉得挺好，Logo我做了好多个版本，最终采用这个版本。


##技术关键点

###云

imTime在设计之初就考虑到了各种云平台，一些对资源占用较大的功能被独立出来，比如像智能识别、邮件发送功能、邮件添加日程功能、智能机器人等，都会被放到各种免费云上，利用自动化调度功能，可以在全世界范围内申请无数的免费云来解决问题。

###Node.JS

imTime采用Node.JS开发，模板采用Jade，CSS采用Less，当然我也考虑过CoffceScript，但是因为种种原因放弃，如果有机会再写下一版，我想我会使用像CoffceScript或者TypeScript这类的语法糖。

###MongoDB

服务器的数据库采用MongoDB，Busy客户端采用的数据库为Sqlite，服务器与客户端存储所采用的都是同一份代码。

###Node.JS的第三方模块

项目需要的第三方包有Express、xregexp、mongoose，因为服务器是采用静态html文件和css，所以jade和less仅在我本地运行。

###REST API

很早我做项目就采用数据与实现分离的方式，但对于API的设计都很随意，第一次用较规范的方式来设计API。REST API带来的不仅是简洁的API，而是实实在在的好处，用脚本语言调用你能明显感觉到好处。不包含登陆注册之类的API，所有API加起来只有4个URL，每个API分别有GET/PUT/DELETE/POST四种方法。除了API的简洁，还有对Header的利用等等。

###i18n&l10n

多国语言也是我一直喜欢干的事，早在2006年我做的一个开源ASP小论坛就是支持多国语言的。项目从一开始如果不考虑多国语言的话，以后改起来会非常麻烦，语言的分离与数据分离同等重要。i18n和l10n要讲起来可以专门写一篇文章，有人说不就是加个语言的事吗，实际上要复杂得多。细节到文件夹和文件名的规划，域名的方案等等


###客户端的第三方项目

客户端采用的第三方项目有jQuery，iScroll，并没有采用jQuery UI和jQueryMobile，jQuery UI太庞大了。日历控件是自己写的，因为要实现农历和其它一些功能。最初的想法是不用jQuery了，因为它太臃肿了，不适合在智能机上运行。本来我自己以前写重复造了一个轮子，后来考虑再三，特别是看到jQuery可以分拆打包之后，还是采用jQuery。

##数据

为了跨平台，当然不仅仅是为了跨平台，模块化本身对项目也有好处。整个项目的文件被彻底打散

###17个Less文件

每个Busy客户端里最终打的CSS文件只有一个，但这一个CSS文件都是由这19个Less文件组合而成的。

###30个Jade文件

Busy产品和imTime主要都只有一个页面，由大约25个左右的Jade最终组合成不同平台下的产品。差别最大的是手机版本，平板与PC网站及浏览器扩展差别很小。最终生成的主要HTML文件只有3百多行。

###115个JS文件

别看产品功能不多，但代码可不少，这里的115个JS，其中有效的大概在100个以上，少数文件可以抛弃。这里所有的代码都自己写的，不包括第三方模块或者代码。最终这些JS在客户端将会打包为数百K的文件，PC网站上的JS经过GZip之后仅30几K，当然在不同客户端的代码是不一样的。

###7个请求

主要功能页仅7个请求，我甚至取消了Google的统计，现阶段的统计对我实在没有意义，因为我现在也不在乎它的访问量。其中图片文件1个，JS文件4个，CSS文件1个，HTML文件一个。

###3种语言

多国语言和跨平台是我最喜欢做的事了，所以imTime在第三个版本就是多国语言，支持简繁英日四种语言，第二个版本放弃了日语，因为没有靠谱之人的翻译。就目前的情况来看，再增加一种语言只需要翻译语言文件就可以了，每种语言的成本大概在1000元左右。甚至可以采用众包模式由用户自己翻译，我只需要开发一个简单的平台就可以了。

##分享

按我的计划是需要在明年推出产品并写博客进行总结的，因为本来我的身体是恢复良好的，我甚至乐观地认为，过完年我就可以上班了，我连简历都写好了。事与愿望违，病情的转变让我不得不考虑提前上线并写文章与大家分享。

我准备将这次实验项目的经历写成一个系统文章，其实我有考虑过分享源代码，但从学习的角度看，我觉得我的文章已经能很清楚地说明问题。开放代码只会培养一些伸手党甚至恶劣的抄袭者，JS的代码本来也是无法完全保密的，有心学习的人自然可以找到办法。

大概在下周，我将要去长沙的医院做一次检查，很快我将会住院治疗数月，一切都将不可预料，机会也只有50%。但不管怎么样，只要发生在你身上，就算是0.1%也是100%。

希望这不会是我最后一次写系列文章。

##遗憾与牵挂

人生总是太多的遗憾，我不惧怕死亡，真的一点也不怕，我只是觉得自己的事没有做完，还有一些遗憾。我希望我可以把经验分享出来，给有需要的人。如果这个项目最终成功做完，那是怎样的一番景象，想一想在几乎所有平台上都能看到我的产品，那种感觉，我想是很爽的。

自从我20岁开始，我就没有浪费我的生命，我想我是对得住我自己的，就算今天突然离去，我也无憾。我一直在努力为梦想而奋斗，只是老天不愿意给我这个机会，屌丝的逆袭是要遭到天遣的。

母亲肯定是我最大的牵挂，我努力不要走在她的前面。我母亲在她30岁的时候送走我父亲，现在她快60岁了，可能又将亲手送走自己的儿子，我实在无法想象这种痛苦。所以我必需活下去，为了未竟之梦想，为了一生苦难的母亲。